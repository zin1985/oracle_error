# ORA-01034: ORACLE not available

2024-10-27

## 1. エラー番号・タイトル

ORA-01034: ORACLE not available

このエラーは、Oracleデータベースへの接続試行が失敗し、データベースが利用できないことを示します。  様々な要因が考えられますが、根本的にはクライアントアプリケーションがデータベースサーバに接続できない状態にあることを意味します。単なるネットワーク接続の問題から、データベースサーバ自体の停止、リスナーの問題、あるいはクライアント側の設定ミスまで、幅広い原因が潜んでいます。このエラーは開発中、テスト中、本番運用中問わず、発生する可能性があり、迅速な対応が求められます。特に本番環境で発生した場合、業務に深刻な影響を与えるため、原因究明と対策は非常に重要です。エラーメッセージだけでは原因特定が難しい場合が多く、詳細なログの確認やデータベース管理者への連絡が必要となるでしょう。


## 2. 原因

ORA-01034エラーの発生原因は多岐に渡ります。代表的なものを以下に挙げます。

* **データベースサーバの停止:** データベースサーバ自体が停止している、またはクラッシュしている場合、クライアントは接続できません。
* **ネットワーク接続の問題:** クライアントとデータベースサーバ間のネットワーク接続が切断されている、またはファイアウォールなどのネットワークセキュリティによって接続がブロックされている可能性があります。IPアドレスの誤り、ポート番号の不一致なども原因として考えられます。
* **リスナーの問題:** Oracleリスナーが起動していない、または正しく動作していない場合、クライアントはデータベースに接続できません。リスナーはクライアントからの接続要求をデータベースインスタンスに転送する役割を果たしており、これが機能しないと接続は失敗します。
* **Oracleインスタンスの停止:** データベースサーバは稼働していても、Oracleインスタンス自体が停止している場合もこのエラーが発生します。インスタンスはデータベースを動作させるためのプロセスであり、これが停止すると接続は不可能になります。
* **接続文字列の誤り:** クライアント側の接続文字列に誤りがあると、データベースに接続できません。ホスト名、ポート番号、SID、サービス名などが正しく設定されているか確認する必要があります。
* **パスワードの誤り:**  ユーザー名とパスワードが間違っている場合も接続に失敗します。大文字小文字の区別にも注意が必要です。
* **ライセンスの問題:** Oracleのライセンスに問題がある場合、接続が拒否される可能性があります。


## 3. 解決方法（SQLや設定例付き）

ORA-01034エラーの解決方法は、原因によって異なります。まず、以下の手順で原因を特定する必要があります。

1. **データベースサーバの確認:** サーバが起動しているか、そして正常に動作しているかを確認します。
2. **ネットワーク接続の確認:** クライアントとデータベースサーバ間のネットワーク接続を確認します。pingコマンドなどで接続性を確認できます。
3. **リスナーの確認:** `lsnrctl status`コマンドでリスナーの状態を確認します。リスナーが起動していない場合は、`lsnrctl start`コマンドで起動します。
4. **インスタンスの確認:** SQL*PlusやSQL Developerなどのツールを使って、インスタンスが起動しているか確認します。
5. **接続文字列の確認:**  接続文字列に誤りがないか確認します。例：

```sql
SQL> CONNECT user/password@//host:port/service_name;
```

   もしくは、`tnsnames.ora`ファイルを確認し、正しい接続情報が設定されているか確認します。

6. **パスワードの確認:** ユーザー名とパスワードが正しいか確認します。大文字小文字の区別にも注意してください。

**例：tnsnames.oraファイル**

```
<background>
ORCL =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = mydatabasehost)(PORT = 1521))
    (CONNECT_DATA =
      (SERVICE_NAME = orcl)
    )
  )
</background>
```

リスナーが起動していない場合は、以下のコマンドで再起動を試みます。

```bash
<background>
lsnrctl restart
</background>
```


## 4. 類似エラーとの違い

ORA-01034は、データベースへの接続が完全に失敗したことを示すエラーです。他の接続エラーと比較すると、より根本的な問題を示唆しています。例えば、ORA-12154はリスナーに接続できないことを示しますが、ORA-01034はリスナーの問題だけでなく、データベースサーバ自体やインスタンスの問題も包含します。ORA-28000シリーズのエラーは認証に失敗したことを示しますが、ORA-01034は認証の前に接続自体が失敗していることを示します。


## 5. 反省と対策

今回のORA-01034エラー発生を通して、データベースサーバの監視体制の強化、および定期的なバックアップ実施の重要性を再認識しました。また、ネットワーク接続状況のモニタリング、リスナーの健全性チェックを日常業務に取り入れる必要性を感じました。エラー発生時の迅速な対応のため、手順書を整備し、関係者への連絡体制を明確化することで、ダウンタイムを最小限に抑えることを目指します。


## 6. 再発防止策

* **データベースサーバの監視:** サーバのCPU使用率、メモリ使用率、ディスク容量などを監視し、異常を早期に検知します。ZabbixやNagiosなどの監視ツールを活用することを検討します。
* **リスナーの監視:** リスナーの状態を定期的に監視し、異常発生時にアラートを発報する仕組みを構築します。
* **定期的なバックアップ:** 定期的にデータベースのバックアップを作成し、障害発生時の復旧時間を短縮します。
* **接続文字列の確認・管理:** 接続文字列をバージョン管理システムで管理し、誤った設定によるエラーを防ぎます。
* **ネットワークセキュリティのレビュー:** ファイアウォール設定などを確認し、データベースへのアクセスを適切に制限します。
* **ユーザー教育:** データベースアクセスに関する適切な手順をユーザーに教育します。


## 7. 関連リンクや根拠URL

* [Oracle公式ドキュメント](※Oracle公式ドキュメントへのリンクは、アクセス制限やドキュメントの構成変化により、直接リンクを貼ることができません。検索エンジンで"ORA-01034"を検索することで、関連情報を容易に得ることができます。)


このブログ記事が、ORA-01034エラーの解決に役立つことを願っています。  エラーが発生した場合、焦らずに一つずつ原因を特定し、適切な対処を行うことが重要です。  継続的な監視と予防策の実施が、システムの安定稼働に繋がります。
